<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AnyCasts, ep.6: Learn to fly.io with AnyCable</title>
    <meta name='viewport' content='width=device-width viewport-fit=cover' />
    <meta charset='UTF-8' />
    <meta http-equiv='Permissions-Policy' content='interest-cohort=()' />
      <meta
      name='theme-color'
      content='#fff'
      media='(prefers-color-scheme: light)'
    />
    <meta
      name='theme-color'
      content='#fff'
      media='(prefers-color-scheme: dark)'
    />
      <!-- Posthog -->
      <script> !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_fc9VFWdFAAm5gSlCodHq93iaxxnTTKbjOwsWgAS1FMP',{api_host:'https://app.posthog.com'})</script>
      <!-- End Posthog -->
    <meta name="description" content="This episode demonstrates how to deploy Action Cable and
      AnyCable applications to Fly.io."/>
    <meta name="keywords" content="anycable, ruby on rails, rails, actioncable, websocket, grpc, ruby, erlang, golang"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/>
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="theme-color" content="#000000"/>
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="AnyCasts, ep.6: Learn to fly.io with AnyCable"/>
    <meta itemprop="description" content="This episode demonstrates how to deploy Action Cable and
      AnyCable applications to Fly.io."/>
    <meta itemprop="image" content="https://anycable.io/images/share.png"/>
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@any_cable"/>
    <meta name="twitter:title" content="AnyCasts, ep.6: Learn to fly.io with AnyCable"/>
    <meta name="twitter:description" content="This episode demonstrates how to deploy Action Cable and
      AnyCable applications to Fly.io."/>
    <meta name="twitter:creator" content="@any_cable"/>
    <meta name="twitter:image" content="https://anycable.io/images/share.png"/>
    <!-- Open Graph data -->
    <meta property="og:title" content="AnyCasts, ep.6: Learn to fly.io with AnyCable"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://anycable.io/"/>
    <meta property="og:image" content="https://anycable.io/images/share.png"/>
    <meta property="og:description" content="This episode demonstrates how to deploy Action Cable and
      AnyCable applications to Fly.io."/>
    <meta property="og:site_name" content="AnyCable"/>
    <script type=application/ld+json>
      {
        "@context": "http://schema.org/",
        "@type": "WebSite",
        "name": "AnyCable",
        "url": "https://anycable.io"
      }
    </script>
    <script type=application/ld+json>
      {
        "@context": "http://schema.org/",
        "@type": "SoftwareSourceCode",
        "image": "https://anycable.io/images/logos/anycable.png",
        "name": "AnyCable",
        "description": "Add real-time features to your Ruby on Rails application without ever having to switch to another platform or language. Stay productive by writing clean, maintainable code in Ruby while being sure that your application scales without costing a fortune to run it.",
        "codeRepository": "https://github.com/anycable/anycable"
      }
    </script>
    <script type=application/ld+json>
      {
        "@context": "http://schema.org/",
        "@type": "SoftwareApplication",
        "image": "https://anycable.io/images/logos/anycable.png",
        "name": "AnyCable",
        "applicationCategory": "Web",
        "operatingSystem": "Any"
      }
    </script>
    <script type="module" crossorigin src="/assets/popups-show-hide-c6eef21e.js"></script>
    <link rel="stylesheet" href="/assets/index-blog-0be3fbfb.css">
  </head>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/a11y-light.min.css"
    integrity="sha512-WDk6RzwygsN9KecRHAfm9HTN87LQjqdygDmkHSJxVkVI7ErCZ8ZWxP6T8RvBujY1n2/E4Ac+bn2ChXnp5rnnHA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <body>
    <header class='blog-header'>
      <nav class='blog-header__content'>
        <a class='link blog-header__link' href='/blog'>
          <span class='blog-header__link-icon'>
            <svg fill="none" height="16" viewBox="0 0 10 16" width="10" xmlns="http://www.w3.org/2000/svg">
      <path d="m9 1-7 7 7 7" stroke="#f32b2b" stroke-width="2" />
    </svg>
    
          </span>Other Posts</a>
        <button class='button try-now-btn'>Try it now</button>
      </nav>
    </header>    <div class="blog--content"><h1><img src="/images/demo.svg" class="blog--title-icon"> Learn to Fly.io with AnyCable</h1>
<p class="date">September 6, 2022</p>
<br/>
<div class="divider"></div>
<p>In this episode, we explore <a href="https://fly.io">Fly.io</a> capabilities in deploying Rails real-time applications:</p>
<ul>
<li>Deploying a <em>pure</em> Rails Action Cable application to Fly.</li>
<li>Load-testing <em>Flying</em> Action Cable with k6 and <a href="https://github.com/anycable/xk6-cable">xk6-cable</a>.</li>
<li>Deploying <a href="/blog/jwt-identification-and-hot-streams/">RPC-less</a> version of AnyCable and load-testing it.</li>
<li>Adding RPC server to the equation with just a couple of configuration changes.</li>
<li>Exporting <a href="https://docs.anycable.io/anycable-go/instrumentation">AnyCable metrics</a> to <a href="https://fly.io/docs/reference/metrics/">fly-metrics.io</a>.</li>
</ul>
<figure class="blog--figure">
  <iframe class="blog--youtube" src="https://youtube.com/embed/j9JqlbMAQKY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</figure>
<div class="divider"></div>
<p><strong>Benchmark results</strong></p>
<ul>
<li>Action Cable server (single-worker Puma) crashed due to out-of-memory at about <strong>700 concurrent connections</strong>.</li>
<li>AnyCable (RPC-less) passed <strong>2700 concurrent connections</strong> and consumed only a half of the available RAM (~120MB).</li>
</ul>
<p><strong>Links</strong>:</p>
<ul>
<li><a href="https://docs.anycable.io/deployment/fly">Official Fly deployment guide for AnyCable</a></li>
<li><a href="https://fly.io/docs/rails/">Fly.io Rails guides</a></li>
<li><a href="https://evilmartians.com/chronicles/real-time-stress-anycable-k6-websockets-and-yabeda?utm_source=anycable-web">Real-time stress: AnyCable, k6, WebSockets, and Yabeda</a></li>
</ul>
<p><strong>Errata</strong>:</p>
<ul>
<li>
<p>Getting an app's Ruby version from the Gemfile has been fixed in the recent <code>flyctl</code> versions (see <a href="https://github.com/superfly/flyctl/issues/1242">issue</a>)</p>
</li>
<li>
<p>Redis connections termination is intentional and has nothing with load-testing. See <a href="https://fly.io/docs/rails/getting-started/#patching-action-cable-to-handle-redis-timeouts">the Fly docs</a></p>
</li>
</ul>
</div>
    <footer class='footer'>
  <div class='footer__columns'>
    <div class='footer__column footer__column_content_downloads'>
      <h3 class='footer__column-heading'>Downloads</h3>
      <nav class='footer__navigation'>
        <ul class='footer__column-links'>
          <li class='footer__list-item'>
            <a
              href='https://github.com/anycable/anycable'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-github'
            >GitHub</a>
          </li>
          <li class='footer__list-item'>
            <a
              href='https://rubygems.org/gems/anycable'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-rubygems'
            >RubyGems</a>
          </li>
          <li class='footer__list-item'>
            <a
              href='https://hub.docker.com/u/anycable'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-docker'
            >DockerHub</a>
          </li>
        </ul>
      </nav>
    </div>
    <div class='footer__column footer__column_content_resources'>
      <h3 class='footer__column-heading'>Resources</h3>
      <nav class='footer__navigation'>
        <ul class='footer__column-links'>
          <li class='footer__list-item'>
            <a
              href='https://docs.anycable.io/'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-docs'
            >Documentation</a>
          </li>
          <li class='footer__list-item'>
            <a
              href='https://github.com/anycable/anycable_rails_demo'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-demo'
            >Demo App</a>
          </li>
          <li class='footer__list-item'>
            <a href='/blog' class='link' data-ph-capture-attribute-link-id='footer-blog'>Blog</a>
          </li>
          <li class='footer__list-item'>
            <a
              href='https://www.youtube.com/playlist?list=PLAgBW0XUpyOVFnpoS6FKDszd8WEvXzg-A'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-screencasts'
            >Screencasts
            </a>
          </li>
        </ul>
      </nav>
    </div>
    <div class='footer__column footer__column_content_community'>
      <h3 class='footer__column-heading'>Community</h3>
      <nav class='footer__navigation'>
        <ul class='footer__column-links'>
          <li class='footer__list-item'>
            <a
              href='https://discord.gg/stimulus-reflex'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-discord'
            >Discord</a>
          </li>
          <li class='footer__list-item'>
            <a
              href='https://anycable.substack.com/'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-substack'
            >Newsletter</a>
          </li>
          <li class='footer__list-item'>
            <a
              href='https://twitter.com/any_cable'
              class='link'
              target='_blank'
              data-ph-capture-attribute-link-id='footer-twitter'
            >Twitter</a>
          </li>
        </ul>
      </nav>
    </div>
    <div class='footer__column footer__column_content_legals'>
      <p class='footer__legal footer__legal_type_copyright'>
        2023
        <a
          class='link'
          href='https://twitter.com/palkan_tula'
          target='_blank'
          data-ph-capture-attribute-link-id='footer-twitter-palkan'
        >Vladimir Dementyev&nbsp;</a>&amp;&nbsp;<a
          class='link'
          href='https://evilmartians.com/'
          data-ph-capture-attribute-link-id='footer-evlms'
        >Evil Martians</a>
      </p>
      <p class='footer__legal'>
        Released under the
        <a
          class='link'
          href='https://opensource.org/licenses/MIT'
          target='_blank'
          data-ph-capture-attribute-link-id='footer-mit'
        >MIT License</a>
      </p>
      <p class='footer__legal'>
        Website by
        <a
          class='link'
          href='https://twitter.com/antiflasher'
          data-ph-capture-attribute-link-id='footer-twitter-antiflasher'
          target='_blank'
        >Anton Lovchikov</a>
      </p>
      <p class='footer__legal'>
        Drop us a line:
        <a
          class='link'
          href='mailto:anycable@evilmartians.com'
          target='_blank'
        >anycable@evilmartians.com</a>
      </p>
      <p class='footer__legal'>
        By using this site, you agree with our
          <a href="https://www.iubenda.com/privacy-policy/14230174" class="link iubenda-nostyle iubenda-embed iub-legal-only iubenda-noiframe" title="Privacy policy ">Privacy policy</a><script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src="https://cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
      </p>
      <div class='footer__humanoids'>
        <div class='footer__humanoid footer__humanoid_type_martian'>
          <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 108 92' width='54'>
            <path fill='#f64242' d='M26 88L8 78l18-10'></path>
            <path
              fill='#f64242'
              d='M94 92v-6H44c-5.5 0-10-4.5-10-10s4.5-10 10-10h50V32c0-14-7.9-22-22-22H48c-14.1 0-22 8-22 22v60h68z'
            ></path>
            <circle fill='#FFF' cx='48' cy='50' r='8'></circle>
            <circle fill='#FFF' cx='72' cy='50' r='8'></circle>
            <circle fill='#BF6C35' cx='48' cy='50' r='4'></circle>
            <circle fill='#BF6C35' cx='72' cy='50' r='4'></circle>
            <g fill='#663F4C'>
              <path
                d='M48 60c-5.5 0-10-4.5-10-10s4.5-10 10-10 10 4.5 10 10-4.5 10-10 10zm0-16c-3.3 0-6 2.7-6 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6zM82 50c0 5.5-4.5 10-10 10s-10-4.5-10-10 4.5-10 10-10 10 4.5 10 10zm-16 0c0 3.3 2.7 6 6 6s6-2.7 6-6-2.7-6-6-6-6 2.7-6 6z'
              ></path>
              <path
                d='M102 8c-3.8 0-6-2.2-6-6 0-1.1-.9-2-2-2s-2 .9-2 2c0 2.2.5 4.1 1.5 5.7L88.2 13c-4-3.3-9.5-5-16.2-5H48c-6.7 0-12.2 1.7-16.2 4.9l-5.3-5.3C27.5 6.1 28 4.2 28 2c0-1.1-.9-2-2-2s-2 .9-2 2c0 3.8-2.2 6-6 6-1.1 0-2 .9-2 2s.9 2 2 2c2.2 0 4.1-.5 5.7-1.5l5.3 5.3c-3.2 4-4.9 9.5-4.9 16.2v34.8L3.9 78 24 89v3h4V32c0-12.9 7.1-20 20-20h24c12.9 0 20 7.1 20 20v32H44c-6.6 0-12 5.4-12 12s5.4 12 12 12h48v4h4v-8h-2l-4-8-4 8h-4l-4-8-4 8h-4l-4-8-4 8h-4l-4-8-4 8h-4l-4-8-3.1 6.2C37.1 80.7 36 78.5 36 76c0-4.4 3.6-8 8-8l4 8 4-8h4l4 8 4-8h4l4 8 4-8h4l4 8 4-8h8V32c0-6.7-1.7-12.2-4.9-16.2l5.3-5.3c1.6 1 3.5 1.5 5.7 1.5 1.1 0 2-.9 2-2s-1-2-2.1-2zM24 84.4L12.1 78 24 71.4v13z'
              ></path>
            </g>
          </svg>
        </div>
        <div class='footer__humanoid footer__humanoid_type_human'>
          <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 108 92' width='54'>
            <path
              fill='#FFFFFF'
              d='M14 62v30h68v-6H32c-5.5 0-10-4.5-10-10s4.5-10 10-10h50v-4c4 0 8-3.6 8-8s-4-8-8-8V32c0-14-7.9-22-22-22H36c-14.1 0-22 8-22 22v14c-4 0-8 3.6-8 8s4 8 8 8z'
            ></path>
            <circle fill='#FFF' cx='36' cy='50' r='8'></circle>
            <circle fill='#FFF' cx='60' cy='50' r='8'></circle>
            <circle fill='#f64242' cx='36' cy='50' r='4'></circle>
            <circle fill='#f64242' cx='60' cy='50' r='4'></circle>
            <path
              fill='#f64242'
              d='M60 10H36c-14.1 0-22 8-22 22v2l4-4 6 6 6-6 6 6 6-6 6 6 6-6 6 6 6-6 6 6 6-6 4 4v-2c0-14-7.9-22-22-22z'
            ></path>
            <g fill='#663F4C'>
              <path
                d='M36 60c-5.5 0-10-4.5-10-10s4.5-10 10-10 10 4.5 10 10-4.5 10-10 10zm0-16c-3.3 0-6 2.7-6 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6zM60 60c-5.5 0-10-4.5-10-10s4.5-10 10-10 10 4.5 10 10-4.5 10-10 10zm0-16c-3.3 0-6 2.7-6 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6z'
              ></path>
              <path
                d='M12 63.8V92h4V32c0-12.9 7.1-20 20-20h24c12.9 0 20 7.1 20 20v32H32c-6.6 0-12 5.4-12 12s5.4 12 12 12h48v4h4v-8H74v-1c0-1.7-1.3-3-3-3s-3 1.3-3 3v1h-6v-1c0-1.7-1.3-3-3-3s-3 1.3-3 3v1h-6v-1c0-1.7-1.3-3-3-3s-3 1.3-3 3v1h-6v-1c0-1.7-1.3-3-3-3s-3 1.3-3 3v1c-4 0-8-3.6-8-8s3.6-8 8-8h6v1c0 1.7 1.3 3 3 3s3-1.3 3-3v-1h6v1c0 1.7 1.3 3 3 3s3-1.3 3-3v-1h6v1c0 1.7 1.3 3 3 3s3-1.3 3-3v-1h6v1c0 1.7 1.3 3 3 3s3-1.3 3-3v-1h4v-4.2c5-.9 8-5 8-9.8s-3-8.9-8-9.8V32c0-15.3-8.7-24-24-24H36c-15.3 0-24 8.7-24 24v12.2c-5 .9-8 5-8 9.8s3 8.9 8 9.8zm72-15.5c2 .8 4 3 4 5.7s-2 4.8-4 5.7V48.3zm-72 0v11.3c-2-.8-4-3-4-5.7s2-4.7 4-5.6z'
              ></path>
            </g>
          </svg>
        </div>
      </div>    </div>
  </div>
</footer>
 <div class='popup try-now-popup'>
  <div class='popup__container'>
    <button
      class='popup__close-btn'
      type='button'
      aria-label='Close'
    ></button>
    <iframe
      class='popup__iframe'
      src='https://form.typeform.com/to/BwBcZmdQ'
    ></iframe>
  </div>
</div>

    
  </body>
</html>
